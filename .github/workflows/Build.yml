name: Build

on:
#testing reusable workflow
  workflow_call:
#    inputs:
#      client-payload:
#        required: true
#        type: string
#      event-type:
#        required: true
#        type: string
    secrets:
      parent_access_token:
        required: true
  #testing reusable workflow

#  repository_dispatch:
#    types: [Build]
  workflow_dispatch:

jobs:
  Build:
    if: ${{ startsWith(github.ref, 'refs/tags/') }}
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.event.client_payload.ref }}

      - uses: actions/setup-java@v2
        name: Setup Java
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      - name: package
        run: mvn package -Dmaven.test.skip=true

      - uses: actions/upload-artifact@v3
        name: Upload JAR Artifact
        with:
          name: JAR_Releases
          path: ./packages
          if-no-files-found: error

#  Release:
#    if: ${{ startsWith(github.ref, 'refs/tags/') }}
#    needs: Build
#    uses: GingerNinja2962/FoondaMate_Graph_Project/.github/workflows/Release.yml@main
#    #    with:
#    #      event-type: Build
#    #      client-payload: '{"ref": "${{ github.ref }}", "ref_name": "${{ github.ref_name }}"}'
#    secrets:
#      parent_access_token: ${{ secrets.parent_access_token }}

#    needs: Build
#    runs-on: ubuntu-latest
#
#    steps:
#      - name: Repository Dispatch [Release]
#        if: always()
#        uses: peter-evans/repository-dispatch@v1
#        with:
#          token: ${{ secrets.parent_access_token }}
##          token: ${{ secrets.REPO_ACCESS_TOKEN }}
#          event-type: Release
#          client-payload: '{"ref": "${{github.ref}}", "ref_name": "${{ github.ref_name }}", "run_id": "${{ github.run_id }}"}'
